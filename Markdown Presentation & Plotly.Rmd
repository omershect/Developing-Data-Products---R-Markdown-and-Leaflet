---
title: "R Markdown and Leaflet - 2017 Car crash data in Allegheny County"
author: "Omer Shechter"
date: "23 November 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load libraries 
```{r}
library(leaflet)
library(tidyr)
library(dplyr)
```
# Project Summary


Read 2017 Car crash data in Allegheny County.
```{r}
DF<-read.csv("CarCrash2017.csv")

```

# Interactive MAP - Total car crash by month

Subset the location of the car crash 
Keep the month of the crash 
Create a new column with the months names instead of a number 
Since there is a large number of the crash 
There will be an option to show car crash per specific month
```{r}
dfCrash<-select(DF,DEC_LAT,DEC_LONG,CRASH_MONTH)
colnames(dfCrash)<-c("latitude","longitude","Month Crash")
dfCrash<-dfCrash %>% drop_na()
dfCrash<-mutate(dfCrash,Month.Crash.Name=month.name[dfCrash$`Month Crash`])
```


Use a PNG file as an icon for markers on the MAP 
```{r}

CarsIcon <- makeIcon("CarsIcon1.png",iconWidth = 45, iconHeight = 45)
```

Helper function to add markers 
```{r}

Add_Marker <- function(my_map,lat_ln_data,groupname,iconMarker=CarsIcon) {
  addMarkers(my_map,data=lat_ln_data,clusterOptions = markerClusterOptions(),group =groupname,icon = iconMarker)
  
}

```


# 2017 Car crash data of Allegheny County
```{r echo=FALSE ,message = FALSE}
my_map<-dfCrash %>% 
  leaflet() %>%
  addTiles() 

for (index in 1:12){
  my_map<-Add_Marker(my_map,subset(dfCrash,dfCrash$`Month Crash`==index),month.name[index])
  
}
  # Layers control
  addLayersControl(my_map,baseGroups = month.name,
    options = layersControlOptions(collapsed = FALSE)
  )
  

```


